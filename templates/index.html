<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Paint Home - Smart Wall Color Suggestion</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="container">
    <h1>Paint Home</h1>
    <p>Upload your wall image or click with camera to get the best color suggestions.</p>

    <input type="file" id="imageInput" accept="image/*">
    <button onclick="uploadImage()">Suggest Colors</button>
    <button onclick="openCamera()">Capture from Camera</button>

    <video id="camera" autoplay playsinline style="display:none;"></video>
    <canvas id="canvas" style="display:none;"></canvas>

    <div id="result"></div>
  </div>

  <script>
    async function uploadImage() {
      const input = document.getElementById('imageInput');
      const file = input.files[0];
      if (!file) return alert("Please upload an image!");

      const formData = new FormData();
      formData.append("image", file);

      const res = await fetch('/color-suggestion', {
        method: 'POST',
        body: formData
      });

      const data = await res.json();
      document.getElementById('result').innerHTML = `
        <h2>Suggested Color:</h2>
        <div style="width:100px;height:100px;background:${data.suggested_color};margin:auto;border-radius:10px;"></div>
        <p>${data.suggested_color}</p>
      `;
    }

    function openCamera() {
      const video = document.getElementById("camera");
      const canvas = document.getElementById("canvas");
      const input = document.getElementById("imageInput");

      video.style.display = "block";

      navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => {
          video.srcObject = stream;

          video.addEventListener("click", () => {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);

            canvas.toBlob(blob => {
              const file = new File([blob], "captured.jpg", { type: "image/jpeg" });
              const dt = new DataTransfer();
              dt.items.add(file);
              input.files = dt;
              uploadImage();
            });
          });
        });
    }
  </script>
</body>
</html>
